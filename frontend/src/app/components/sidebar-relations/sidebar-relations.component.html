@if (loading()) {
  <div class="flex justify-center p-4">
    <span class="loading loading-spinner loading-md"></span>
  </div>
} @else if (error()) {
  <div class="p-4 text-error">
    <p>{{ error()?.message }}</p>
  </div>
} @else {
  <div class="overflow-y-auto max-h-[70vh] p-2">
    @for (type of getFilteredTypes(); track type) {
      <div class="collapse collapse-arrow bg-base-100 mb-1">
        <input type="checkbox" class="peer" /> 
        <div class="collapse-title text-sm font-medium flex justify-between items-center">
          <span>{{ type }}</span>
        </div>
        <div class="collapse-content p-0">
          @for (subtype of getFilteredSubtypes(type); track subtype) {
            <div class="collapse collapse-arrow bg-base-100 ml-2 mb-1">
              <input type="checkbox" class="peer" /> 
              <div class="collapse-title text-xs font-medium flex justify-between items-center">
                <span>{{ subtype }}</span>
              </div>
              <div class="collapse-content p-0">
                <ul class="menu menu-sm bg-base-200 rounded-box">
                  @for (relationCount of getRelationCounts(type, subtype); track relationCount.relationName) {
                    <li class="text-xs">
                      <a [routerLink]="['/relations']" 
                         [queryParams]="{type: type, subtype: subtype, relation: relationCount.relationName}"
                         class="flex justify-between items-center w-full">
                        <span>{{ relationCount.relationName }}</span>
                        <span class="badge badge-primary badge-sm">{{ relationCount.count }}</span>
                      </a>
                    </li>
                  }
                </ul>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
}

